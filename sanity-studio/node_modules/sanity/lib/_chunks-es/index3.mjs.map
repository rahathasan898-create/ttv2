{"version":3,"file":"index3.mjs","sources":["../../src/structure/structureResolvers/PaneResolutionError.ts","../../src/structure/structureResolvers/assignId.ts","../../src/structure/structureResolvers/createPaneResolver.ts","../../src/structure/structureResolvers/memoBind.ts","../../src/structure/structureResolvers/resolveIntent.ts","../../src/structure/structureResolvers/createResolvedPaneNodeStream.ts","../../src/structure/structureResolvers/useResolvedPanes.ts","../../src/structure/components/structureTool/intentResolver/utils.ts","../../src/structure/components/structureTool/intentResolver/IntentResolver.tsx","../../src/structure/components/structureTool/StructureError.tsx","../../src/structure/components/structureTool/NoDocumentTypesScreen.tsx","../../src/structure/components/structureTool/StructureTitle.tsx","../../src/structure/components/structureTool/StructureTool.tsx","../../src/structure/components/structureTool/StructureToolBoundary.tsx"],"sourcesContent":["import {type RouterPaneSiblingContext} from '../types'\n\nexport interface PaneResolutionErrorOptions {\n  message: string\n  context?: RouterPaneSiblingContext\n  helpId?: string\n  cause?: Error\n}\n\n/**\n * An error thrown during pane resolving. This error is meant to be bubbled up\n * through react and handled in an error boundary. It includes a `cause`\n * property which is the original error caught\n */\nexport class PaneResolutionError extends Error {\n  cause: Error | undefined\n  context: RouterPaneSiblingContext | undefined\n  helpId: string | undefined\n\n  constructor({message, context, helpId, cause}: PaneResolutionErrorOptions) {\n    super(message)\n    this.name = 'PaneResolutionError'\n    this.context = context\n    this.helpId = helpId\n    this.cause = cause\n  }\n}\n","import {nanoid} from 'nanoid'\n\n// `WeakMap`s require the first type param to extend `object`\nconst randomIdCache = new WeakMap<object, string>()\n\n/**\n * given an object, this function randomly generates an ID and returns it. this\n * result is then saved in a WeakMap so subsequent requests for the same object\n * will receive the same ID\n */\nexport function assignId(obj: object): string {\n  const cachedValue = randomIdCache.get(obj)\n  if (cachedValue) return cachedValue\n\n  const id = nanoid()\n  randomIdCache.set(obj, id)\n  return id\n}\n","import {from, isObservable, type Observable, of as observableOf} from 'rxjs'\nimport {publishReplay, refCount, switchMap} from 'rxjs/operators'\nimport {isRecord} from 'sanity'\n\nimport {type PaneNode, type RouterPaneSiblingContext, type UnresolvedPaneNode} from '../types'\nimport {PaneResolutionError} from './PaneResolutionError'\n\ninterface Serializable {\n  serialize: (...args: never[]) => unknown\n}\n\nconst isPromise = (thing: any): thing is PromiseLike<unknown> => {\n  return !!thing && typeof thing?.then === 'function'\n}\nconst isSerializable = (thing: unknown): thing is Serializable => {\n  if (!isRecord(thing)) return false\n  return typeof thing.serialize === 'function'\n}\n\n/**\n * The signature of the function used to take an `UnresolvedPaneNode` and turn\n * it into an `Observable<PaneNode>`.\n */\nexport type PaneResolver = (\n  unresolvedPane: UnresolvedPaneNode | undefined,\n  context: RouterPaneSiblingContext,\n  flatIndex: number,\n) => Observable<PaneNode>\n\nexport type PaneResolverMiddleware = (paneResolveFn: PaneResolver) => PaneResolver\n\nconst rethrowWithPaneResolutionErrors: PaneResolverMiddleware =\n  (next) => (unresolvedPane, context, flatIndex) => {\n    try {\n      return next(unresolvedPane, context, flatIndex)\n    } catch (e) {\n      // re-throw errors that are already `PaneResolutionError`s\n      if (e instanceof PaneResolutionError) {\n        throw e\n      }\n\n      // anything else, wrap with `PaneResolutionError` and set the underlying\n      // error as a the `cause`\n      throw new PaneResolutionError({\n        message: typeof e?.message === 'string' ? e.message : '',\n        context,\n        cause: e,\n      })\n    }\n  }\n\nconst wrapWithPublishReplay: PaneResolverMiddleware =\n  (next) =>\n  (...args) => {\n    return next(...args).pipe(\n      // need to add publishReplay + refCount to ensure new subscribers always\n      // get an emission. without this, memoized observables may get stuck\n      // waiting for their first emissions resulting in a loading pane\n      publishReplay(1),\n      refCount(),\n    )\n  }\n\nexport function createPaneResolver(middleware: PaneResolverMiddleware): PaneResolver {\n  // note: this API includes a middleware/wrapper function because the function\n  // is recursive. we want to call the wrapped version of the function always\n  // (even inside of nested calls) so the identifier invoked for the recursion\n  // should be the wrapped version\n  const resolvePane = rethrowWithPaneResolutionErrors(\n    wrapWithPublishReplay(\n      middleware((unresolvedPane, context, flatIndex) => {\n        if (!unresolvedPane) {\n          throw new PaneResolutionError({\n            message: 'Pane returned no child',\n            context,\n            helpId: 'structure-item-returned-no-child',\n          })\n        }\n\n        if (isPromise(unresolvedPane) || isObservable(unresolvedPane)) {\n          return from(unresolvedPane).pipe(\n            switchMap((result) => resolvePane(result, context, flatIndex)),\n          )\n        }\n\n        if (isSerializable(unresolvedPane)) {\n          return resolvePane(unresolvedPane.serialize(context), context, flatIndex)\n        }\n\n        if (typeof unresolvedPane === 'function') {\n          return resolvePane(unresolvedPane(context.id, context), context, flatIndex)\n        }\n\n        return observableOf(unresolvedPane)\n      }),\n    ),\n  )\n\n  return resolvePane\n}\n","/* eslint-disable @typescript-eslint/no-unsafe-function-type */\n\n// `WeakMap`s require the first type param to extend `object`\nconst bindCache = new WeakMap<object, Map<string, Function>>()\n\n/**\n * An alternative to `obj.method.bind(obj)` that utilizes a weakmap to return\n * the same memory reference for sequent binds.\n */\nexport function memoBind<\n  T extends object,\n  K extends keyof {[P in keyof T]: T[P] extends Function ? T[P] : never},\n>(obj: T, methodKey: K): T[K]\nexport function memoBind(obj: Record<string, unknown>, methodKey: string): Function {\n  const boundMethods = bindCache.get(obj) || new Map<string, Function>()\n  if (boundMethods) {\n    const bound = boundMethods.get(methodKey)\n    if (bound) return bound\n  }\n\n  const method = obj[methodKey]\n\n  if (typeof method !== 'function') {\n    throw new Error(\n      `Expected property \\`${methodKey}\\` to be a function but got ${typeof method} instead.`,\n    )\n  }\n\n  const bound = method.bind(obj)\n  boundMethods.set(methodKey, bound)\n  bindCache.set(obj, boundMethods)\n\n  return bound\n}\n","import {omit} from 'lodash'\nimport {firstValueFrom, type Observable} from 'rxjs'\n\nimport {type StructureContext} from '../structureBuilder'\nimport {\n  type PaneNode,\n  type RouterPanes,\n  type RouterPaneSiblingContext,\n  type UnresolvedPaneNode,\n} from '../types'\nimport {assignId} from './assignId'\nimport {createPaneResolver, type PaneResolverMiddleware} from './createPaneResolver'\nimport {memoBind} from './memoBind'\n\ninterface TraverseOptions {\n  unresolvedPane: UnresolvedPaneNode | undefined\n  intent: string\n  params: {type: string; id: string; [key: string]: string | undefined}\n  payload: unknown\n  parent: PaneNode | null\n  path: string[]\n  currentId: string\n  flatIndex: number\n  levelIndex: number\n  structureContext: StructureContext\n}\n\nexport interface ResolveIntentOptions {\n  rootPaneNode?: UnresolvedPaneNode\n  intent: string\n  params: {type: string; id: string; [key: string]: string | undefined}\n  payload: unknown\n  structureContext: StructureContext\n}\n\n/**\n * Resolves an intent request using breadth first search. If a match is not\n * found, the intent will resolve to the fallback editor.\n *\n * A match is found if:\n * 1. the `PaneNode` is of type `document` and the its ID matches the intent ID\n * 2. the `PaneNode` is of type `documentList` and the `schemaTypeName` matches\n * 3. the `PaneNode`'s `canHandleIntent` method returns true\n *\n * If a `PaneNode` of type `list` is found, it will be searched for a match.\n *\n * @see PaneNode\n */\nexport async function resolveIntent(options: ResolveIntentOptions): Promise<RouterPanes> {\n  const resolvedPaneCache = new Map<string, Observable<PaneNode>>()\n\n  // this is a simple version of the memoizer in `createResolvedPaneNodeStream`\n  const memoize: PaneResolverMiddleware = (nextFn) => (unresolvedPane, context, flatIndex) => {\n    const key = unresolvedPane && `${assignId(unresolvedPane)}-${context.path.join('__')}`\n    const cachedResolvedPane = key && resolvedPaneCache.get(key)\n    if (cachedResolvedPane) return cachedResolvedPane\n\n    const result = nextFn(unresolvedPane, context, flatIndex)\n    if (key) resolvedPaneCache.set(key, result)\n    return result\n  }\n\n  const resolvePane = createPaneResolver(memoize)\n\n  const fallbackEditorPanes: RouterPanes = [\n    [\n      {\n        id: `__edit__${options.params.id}`,\n        params: {...omit(options.params, ['id']), type: options.params.type},\n        payload: options.payload,\n      },\n    ],\n  ]\n\n  async function traverse({\n    currentId,\n    flatIndex,\n    intent,\n    params,\n    parent,\n    path,\n    payload,\n    unresolvedPane,\n    levelIndex,\n    structureContext,\n  }: TraverseOptions): Promise<\n    Array<{panes: RouterPanes; depthIndex: number; levelIndex: number}>\n  > {\n    if (!unresolvedPane) return []\n\n    const {id: targetId, type: schemaTypeName, ...otherParams} = params\n    const context: RouterPaneSiblingContext = {\n      id: currentId,\n      splitIndex: 0,\n      parent,\n      path,\n      index: flatIndex,\n      params: {},\n      payload: undefined,\n      structureContext,\n    }\n    const resolvedPane = await firstValueFrom(resolvePane(unresolvedPane, context, flatIndex))\n\n    // if the resolved pane is a document pane and the pane's ID matches then\n    // resolve the intent to the current path\n    if (resolvedPane.type === 'document' && resolvedPane.id === targetId) {\n      return [\n        {\n          panes: [\n            ...path.slice(0, path.length - 1).map((i) => [{id: i}]),\n            [{id: targetId, params: otherParams, payload}],\n          ],\n          depthIndex: path.length,\n          levelIndex,\n        },\n      ]\n    }\n\n    // NOTE: if you update this logic, please also update the similar handler in\n    // `getIntentState.ts`\n    if (\n      // if the resolve pane's `canHandleIntent` returns true, then resolve\n      resolvedPane.canHandleIntent?.(intent, params, {\n        pane: resolvedPane,\n        index: flatIndex,\n      }) ||\n      // if the pane's `canHandleIntent` did not return true, then match against\n      // this default case. we will resolve the intent if:\n      (resolvedPane.type === 'documentList' &&\n        // 1. the schema type matches (this required for the document to render)\n        resolvedPane.schemaTypeName === schemaTypeName &&\n        // 2. the filter is the default filter.\n        //\n        // NOTE: this case is to prevent false positive matches where the user\n        // has configured a more specific filter for a particular type. In that\n        // case, the user can implement their own `canHandleIntent` function\n        resolvedPane.options.filter === '_type == $type')\n    ) {\n      return [\n        {\n          panes: [\n            // map the current path to router panes\n            ...path.map((id) => [{id}]),\n            // then augment with the intents IDs and params\n            [{id: params.id, params: otherParams, payload}],\n          ],\n          depthIndex: path.length,\n          levelIndex,\n        },\n      ]\n    }\n\n    if (resolvedPane.type === 'list' && resolvedPane.child && resolvedPane.items) {\n      return (\n        await Promise.all(\n          resolvedPane.items.map((item, nextLevelIndex) => {\n            if (item.type === 'divider') return Promise.resolve([])\n\n            return traverse({\n              currentId: item._id || item.id,\n              flatIndex: flatIndex + 1,\n              intent,\n              params,\n              parent: resolvedPane,\n              path: [...path, item.id],\n              payload,\n              unresolvedPane:\n                typeof resolvedPane.child === 'function'\n                  ? memoBind(resolvedPane, 'child')\n                  : resolvedPane.child,\n              levelIndex: nextLevelIndex,\n              structureContext,\n            })\n          }),\n        )\n      ).flat()\n    }\n\n    return []\n  }\n\n  const matchingPanes = await traverse({\n    currentId: 'root',\n    flatIndex: 0,\n    levelIndex: 0,\n    intent: options.intent,\n    params: options.params,\n    parent: null,\n    path: [],\n    payload: options.payload,\n    unresolvedPane: options.rootPaneNode,\n    structureContext: options.structureContext,\n  })\n\n  const closestPaneToRoot = matchingPanes.sort((a, b) => {\n    // break ties with the level index\n    if (a.depthIndex === b.depthIndex) return a.levelIndex - b.levelIndex\n    return a.depthIndex - b.depthIndex\n  })[0]\n\n  if (closestPaneToRoot) {\n    return closestPaneToRoot.panes\n  }\n\n  return fallbackEditorPanes\n}\n","import {generateHelpUrl} from '@sanity/generate-help-url'\nimport {isEqual} from 'lodash'\nimport {concat, NEVER, type Observable, of as observableOf} from 'rxjs'\nimport {distinctUntilChanged, map, pairwise, scan, startWith, switchMap} from 'rxjs/operators'\n\nimport {type StructureContext} from '../structureBuilder'\nimport {\n  type DocumentPaneNode,\n  type PaneNode,\n  type PaneNodeResolver,\n  type RouterPanes,\n  type RouterPaneSibling,\n  type RouterPaneSiblingContext,\n  type UnresolvedPaneNode,\n} from '../types'\nimport {assignId} from './assignId'\nimport {\n  createPaneResolver,\n  type PaneResolver,\n  type PaneResolverMiddleware,\n} from './createPaneResolver'\nimport {memoBind} from './memoBind'\nimport {PaneResolutionError} from './PaneResolutionError'\n\n/**\n * the fallback editor child that is implicitly inserted into the structure tree\n * if the id starts with `__edit__`\n */\nconst fallbackEditorChild: PaneNodeResolver = (nodeId, context): DocumentPaneNode => {\n  const id = nodeId.replace(/^__edit__/, '')\n  const {\n    params,\n    payload,\n    structureContext: {resolveDocumentNode},\n  } = context\n  const {type, template} = params\n\n  if (!type) {\n    throw new Error(\n      `Document type for document with ID ${id} was not provided in the router params.`,\n    )\n  }\n\n  let defaultDocumentBuilder = resolveDocumentNode({schemaType: type, documentId: id}).id('editor')\n\n  if (template) {\n    defaultDocumentBuilder = defaultDocumentBuilder.initialValueTemplate(\n      template,\n      payload as {[key: string]: unknown},\n    )\n  }\n\n  return defaultDocumentBuilder.serialize() as DocumentPaneNode\n}\n\n/**\n * takes in a `RouterPaneSiblingContext` and returns a normalized string\n * representation that can be used for comparisons\n */\nfunction hashContext(context: RouterPaneSiblingContext): string {\n  return `contextHash(${JSON.stringify({\n    id: context.id,\n    parentId: parent && assignId(parent),\n    path: context.path,\n    index: context.index,\n    splitIndex: context.splitIndex,\n    serializeOptionsIndex: context.serializeOptions?.index,\n    serializeOptionsPath: context.serializeOptions?.path,\n  })})`\n}\n\n/**\n * takes in `ResolvedPaneMeta` and returns a normalized string representation\n * that can be used for comparisons\n */\nconst hashResolvedPaneMeta = (meta: ResolvedPaneMeta): string => {\n  const normalized = {\n    type: meta.type,\n    id: meta.routerPaneSibling.id,\n    params: meta.routerPaneSibling.params || {},\n    payload: meta.routerPaneSibling.payload || null,\n    flatIndex: meta.flatIndex,\n    groupIndex: meta.groupIndex,\n    siblingIndex: meta.siblingIndex,\n    path: meta.path,\n    paneNode: meta.type === 'resolvedMeta' ? assignId(meta.paneNode) : null,\n  }\n\n  return `metaHash(${JSON.stringify(normalized)})`\n}\n\n/**\n * Represents one flattened \"router pane\", including the source group and\n * sibling indexes.\n *\n * @see RouterPanes\n */\ninterface FlattenedRouterPane {\n  routerPaneSibling: RouterPaneSibling\n  flatIndex: number\n  groupIndex: number\n  siblingIndex: number\n}\n\n/**\n * The state of the accumulator used to store and manage memo cache state\n */\ninterface CacheState {\n  /**\n   * Holds the memoization results keyed by a combination of `assignId` and a\n   * context hash.\n   */\n  resolvedPaneCache: Map<string, Observable<PaneNode>>\n  /**\n   * Acts as a dictionary that stores cache keys by their flat index. This is\n   * used to clean up the cache between different branches in the pane\n   * structure.\n   *\n   * @see createResolvedPaneNodeStream look inside the `scan` where `wrapFn` is\n   * defined\n   */\n  cacheKeysByFlatIndex: Array<Set<string>>\n  /**\n   * The resulting memoized `PaneResolver` function. This function closes over\n   * the `resolvedPaneCache`.\n   */\n  resolvePane: PaneResolver\n  flattenedRouterPanes: FlattenedRouterPane[]\n}\n\nexport interface CreateResolvedPaneNodeStreamOptions {\n  /**\n   * an input stream of `RouterPanes`\n   * @see RouterPanes\n   */\n  routerPanesStream: Observable<RouterPanes>\n  /**\n   * any `UnresolvedPaneNode` (could be an observable, promise, pane resolver etc)\n   */\n  rootPaneNode: UnresolvedPaneNode\n  /** used primarily for testing */\n  initialCacheState?: CacheState\n\n  structureContext: StructureContext\n}\n\n/**\n * The result of pane resolving\n */\nexport type ResolvedPaneMeta = {\n  groupIndex: number\n  siblingIndex: number\n  flatIndex: number\n  routerPaneSibling: RouterPaneSibling\n  path: string[]\n} & ({type: 'loading'; paneNode: null} | {type: 'resolvedMeta'; paneNode: PaneNode})\n\ninterface ResolvePaneTreeOptions {\n  resolvePane: PaneResolver\n  flattenedRouterPanes: FlattenedRouterPane[]\n  unresolvedPane: UnresolvedPaneNode | undefined\n  parent: PaneNode | null\n  path: string[]\n  structureContext: StructureContext\n}\n\n/**\n * A recursive pane resolving function. Starts at one unresolved pane node and\n * continues until there is no more flattened router panes that can be used as\n * input to the unresolved panes.\n */\nfunction resolvePaneTree({\n  unresolvedPane,\n  flattenedRouterPanes,\n  parent,\n  path,\n  resolvePane,\n  structureContext,\n}: ResolvePaneTreeOptions): Observable<ResolvedPaneMeta[]> {\n  const [current, ...rest] = flattenedRouterPanes\n  const next = rest[0] as FlattenedRouterPane | undefined\n\n  const context: RouterPaneSiblingContext = {\n    id: current.routerPaneSibling.id,\n    splitIndex: current.siblingIndex,\n    parent,\n    path: [...path, current.routerPaneSibling.id],\n    index: current.flatIndex,\n    params: current.routerPaneSibling.params || {},\n    payload: current.routerPaneSibling.payload,\n    structureContext,\n  }\n\n  try {\n    return resolvePane(unresolvedPane, context, current.flatIndex).pipe(\n      // this switch map receives a resolved pane\n      switchMap((paneNode) => {\n        // we can create a `resolvedMeta` type using it\n        const resolvedPaneMeta: ResolvedPaneMeta = {\n          type: 'resolvedMeta',\n          ...current,\n          paneNode: paneNode,\n          path: context.path,\n        }\n\n        // for the other unresolved panes, we can create \"loading panes\"\n        const loadingPanes = rest.map((i, restIndex) => {\n          const loadingPanePath = [\n            ...context.path,\n            ...rest.slice(restIndex).map((_, currentIndex) => `[${i.flatIndex + currentIndex}]`),\n          ]\n\n          const loadingPane: ResolvedPaneMeta = {\n            type: 'loading',\n            path: loadingPanePath,\n            paneNode: null,\n            ...i,\n          }\n\n          return loadingPane\n        })\n\n        if (!rest.length) {\n          return observableOf([resolvedPaneMeta])\n        }\n\n        let nextStream\n\n        if (\n          // the fallback editor case\n          next?.routerPaneSibling.id.startsWith('__edit__')\n        ) {\n          nextStream = resolvePaneTree({\n            unresolvedPane: fallbackEditorChild,\n            flattenedRouterPanes: rest,\n            parent,\n            path: context.path,\n            resolvePane,\n            structureContext,\n          })\n        } else if (current.groupIndex === next?.groupIndex) {\n          // if the next flattened router pane has the same group index as the\n          // current flattened router pane, then the next flattened router pane\n          // belongs to the same group (i.e. it is a split pane)\n          nextStream = resolvePaneTree({\n            unresolvedPane,\n            flattenedRouterPanes: rest,\n            parent,\n            path,\n            resolvePane,\n            structureContext,\n          })\n        } else {\n          // normal children resolving\n          nextStream = resolvePaneTree({\n            unresolvedPane:\n              typeof paneNode.child === 'function'\n                ? (memoBind(paneNode, 'child') as PaneNodeResolver)\n                : paneNode.child,\n            flattenedRouterPanes: rest,\n            parent: paneNode,\n            path: context.path,\n            resolvePane,\n            structureContext,\n          })\n        }\n\n        return concat(\n          // we emit the loading panes first in a concat (this emits immediately)\n          observableOf([resolvedPaneMeta, ...loadingPanes]),\n          // then whenever the next stream is done, the results will be combined.\n          nextStream.pipe(map((nextResolvedPanes) => [resolvedPaneMeta, ...nextResolvedPanes])),\n        )\n      }),\n    )\n  } catch (e) {\n    if (e instanceof PaneResolutionError) {\n      if (e.context) {\n        console.warn(\n          `Pane resolution error at index ${e.context.index}${\n            e.context.splitIndex > 0 ? ` for split pane index ${e.context.splitIndex}` : ''\n          }: ${e.message}${e.helpId ? ` - see ${generateHelpUrl(e.helpId)}` : ''}`,\n          e,\n        )\n      }\n\n      if (e.helpId === 'structure-item-returned-no-child') {\n        // returning an observable of an empty array will remove loading panes\n        // note: this one intentionally does not throw\n        return observableOf([])\n      }\n    }\n\n    throw e\n  }\n}\n\n/**\n * Takes in a stream of `RouterPanes` and an unresolved root pane and returns\n * a stream of `ResolvedPaneMeta`\n */\nexport function createResolvedPaneNodeStream({\n  routerPanesStream,\n  rootPaneNode,\n  initialCacheState = {\n    cacheKeysByFlatIndex: [],\n    flattenedRouterPanes: [],\n    resolvedPaneCache: new Map(),\n    resolvePane: () => NEVER,\n  },\n  structureContext,\n}: CreateResolvedPaneNodeStreamOptions): Observable<ResolvedPaneMeta[]> {\n  const resolvedPanes$ = routerPanesStream.pipe(\n    // add in implicit \"root\" router pane\n    map((rawRouterPanes) => [[{id: 'root'}], ...rawRouterPanes]),\n    // create flattened router panes\n    map((routerPanes) => {\n      const flattenedRouterPanes: FlattenedRouterPane[] = routerPanes\n        .flatMap((routerPaneGroup, groupIndex) =>\n          routerPaneGroup.map((routerPaneSibling, siblingIndex) => ({\n            routerPaneSibling,\n            groupIndex,\n            siblingIndex,\n          })),\n        )\n        // add in the flat index\n        .map((i, index) => ({...i, flatIndex: index}))\n\n      return flattenedRouterPanes\n    }),\n    // calculate a \"diffIndex\" used for clearing the memo cache\n    startWith([] as FlattenedRouterPane[]),\n    pairwise(),\n    map(([prev, curr]) => {\n      for (let i = 0; i < curr.length; i++) {\n        const prevValue = prev[i]\n        const currValue = curr[i]\n\n        if (!isEqual(prevValue, currValue)) {\n          return {\n            flattenedRouterPanes: curr,\n            diffIndex: i,\n          }\n        }\n      }\n\n      return {\n        flattenedRouterPanes: curr,\n        diffIndex: curr.length,\n      }\n    }),\n    // create the memoized `resolvePane` function and manage the memo cache\n    scan((acc, next) => {\n      const {cacheKeysByFlatIndex, resolvedPaneCache} = acc\n      const {flattenedRouterPanes, diffIndex} = next\n\n      // use the `cacheKeysByFlatIndex` like a dictionary to find cache keys to\n      // and cache keys to delete\n      const beforeDiffIndex = cacheKeysByFlatIndex.slice(0, diffIndex + 1)\n      const afterDiffIndex = cacheKeysByFlatIndex.slice(diffIndex + 1)\n\n      const keysToKeep = new Set(beforeDiffIndex.flatMap((keySet) => Array.from(keySet)))\n      const keysToDelete = afterDiffIndex\n        .flatMap((keySet) => Array.from(keySet))\n        .filter((key) => !keysToKeep.has(key))\n\n      for (const key of keysToDelete) {\n        resolvedPaneCache.delete(key)\n      }\n\n      // create a memoizing pane resolver middleware that utilizes the cache\n      // maintained above. this keeps the cache from growing indefinitely\n      const memoize: PaneResolverMiddleware = (nextFn) => (unresolvedPane, context, flatIndex) => {\n        const key = unresolvedPane && `${assignId(unresolvedPane)}-${hashContext(context)}`\n        const cachedResolvedPane = key && resolvedPaneCache.get(key)\n        if (cachedResolvedPane) return cachedResolvedPane\n\n        const result = nextFn(unresolvedPane, context, flatIndex)\n        if (!key) return result\n\n        const cacheKeySet = cacheKeysByFlatIndex[flatIndex] || new Set()\n        cacheKeySet.add(key)\n        cacheKeysByFlatIndex[flatIndex] = cacheKeySet\n        resolvedPaneCache.set(key, result)\n        return result\n      }\n\n      return {\n        flattenedRouterPanes,\n        cacheKeysByFlatIndex,\n        resolvedPaneCache,\n        resolvePane: createPaneResolver(memoize),\n      }\n    }, initialCacheState),\n    // run the memoized, recursive resolving\n    switchMap(({flattenedRouterPanes, resolvePane}) =>\n      resolvePaneTree({\n        unresolvedPane: rootPaneNode,\n        flattenedRouterPanes,\n        parent: null,\n        path: [],\n        resolvePane,\n        structureContext,\n      }),\n    ),\n  )\n\n  // after we've created a stream of `ResolvedPaneMeta[]`, we need to clean up\n  // the results to remove unwanted loading panes and prevent unnecessary\n  // emissions\n  return resolvedPanes$.pipe(\n    // this diffs the previous emission with the current one. if there is a new\n    // loading pane at the same position where a previous pane already had a\n    // resolved value (looking at the IDs to compare), then return the previous\n    // pane instead of the loading pane\n    scan(\n      (prev, next) =>\n        next.map((nextPane, index) => {\n          const prevPane = prev[index] as ResolvedPaneMeta | undefined\n          if (!prevPane) return nextPane\n          if (nextPane.type !== 'loading') return nextPane\n\n          if (prevPane.routerPaneSibling.id === nextPane.routerPaneSibling.id) {\n            return prevPane\n          }\n          return nextPane\n        }),\n      [] as ResolvedPaneMeta[],\n    ),\n    // this prevents duplicate emissions\n    distinctUntilChanged((prev, next) => {\n      if (prev.length !== next.length) return false\n\n      for (let i = 0; i < next.length; i++) {\n        const prevValue = prev[i]\n        const nextValue = next[i]\n        if (hashResolvedPaneMeta(prevValue) !== hashResolvedPaneMeta(nextValue)) {\n          return false\n        }\n      }\n\n      return true\n    }),\n  )\n}\n","import {useEffect, useMemo, useState} from 'react'\nimport {ReplaySubject} from 'rxjs'\nimport {map} from 'rxjs/operators'\nimport {type RouterState, useRouter} from 'sanity/router'\n\nimport {LOADING_PANE} from '../constants'\nimport {type PaneNode, type RouterPaneGroup, type RouterPanes} from '../types'\nimport {useStructureTool} from '../useStructureTool'\nimport {createResolvedPaneNodeStream} from './createResolvedPaneNodeStream'\n\ninterface PaneData {\n  active: boolean\n  childItemId: string | null\n  groupIndex: number\n  index: number\n  itemId: string\n  key: string\n  pane: PaneNode | typeof LOADING_PANE\n  params: Record<string, string | undefined> & {perspective?: string}\n  path: string\n  payload: unknown\n  selected: boolean\n  siblingIndex: number\n}\n\nexport interface Panes {\n  paneDataItems: PaneData[]\n  routerPanes: RouterPanes\n  resolvedPanes: (PaneNode | typeof LOADING_PANE)[]\n}\n\nfunction useRouterPanesStream() {\n  const [routerStateSubject] = useState(() => new ReplaySubject<RouterState>(1))\n  const routerPanes$ = useMemo(\n    () =>\n      routerStateSubject\n        .asObservable()\n        .pipe(map((_routerState) => (_routerState?.panes || []) as RouterPanes)),\n    [routerStateSubject],\n  )\n  const {state: routerState} = useRouter()\n  useEffect(() => {\n    routerStateSubject.next(routerState)\n  }, [routerState, routerStateSubject])\n\n  return routerPanes$\n}\n\nexport function useResolvedPanes(): Panes {\n  // used to propagate errors from async effect. throwing inside of the render\n  // will bubble the error to react where it can be picked up by standard error\n  // boundaries\n  const [error, setError] = useState<unknown>()\n  if (error) throw error\n\n  const {structureContext, rootPaneNode} = useStructureTool()\n\n  const [data, setData] = useState<Panes>({\n    paneDataItems: [],\n    resolvedPanes: [],\n    routerPanes: [],\n  })\n\n  const routerPanesStream = useRouterPanesStream()\n\n  useEffect(() => {\n    const resolvedPanes$ = createResolvedPaneNodeStream({\n      rootPaneNode,\n      routerPanesStream,\n      structureContext,\n    }).pipe(\n      map((resolvedPanes) => {\n        const routerPanes = resolvedPanes.reduce<RouterPanes>((acc, next) => {\n          const currentGroup = acc[next.groupIndex] || []\n          currentGroup[next.siblingIndex] = next.routerPaneSibling\n          acc[next.groupIndex] = currentGroup\n          return acc\n        }, [])\n\n        const groupsLen = routerPanes.length\n\n        const paneDataItems = resolvedPanes.map((pane) => {\n          const {groupIndex, flatIndex, siblingIndex, routerPaneSibling, path} = pane\n          const itemId = routerPaneSibling.id\n          const nextGroup = routerPanes[groupIndex + 1] as RouterPaneGroup | undefined\n\n          const paneDataItem: PaneData = {\n            active: groupIndex === groupsLen - 2,\n            childItemId: nextGroup?.[0].id ?? null,\n            index: flatIndex,\n            itemId: routerPaneSibling.id,\n            groupIndex,\n            key: `${\n              pane.type === 'loading' ? 'unknown' : pane.paneNode.id\n            }-${itemId}-${siblingIndex}`,\n            pane: pane.type === 'loading' ? LOADING_PANE : pane.paneNode,\n            params: routerPaneSibling.params || {},\n            path: path.join(';'),\n            payload: routerPaneSibling.payload,\n            selected: flatIndex === resolvedPanes.length - 1,\n            siblingIndex,\n          }\n\n          return paneDataItem\n        })\n\n        return {\n          paneDataItems,\n          routerPanes,\n          resolvedPanes: paneDataItems.map((pane) => pane.pane),\n        }\n      }),\n    )\n\n    const subscription = resolvedPanes$.subscribe({\n      next: (result) => setData(result),\n      error: (e) => setError(e),\n    })\n\n    return () => subscription.unsubscribe()\n  }, [rootPaneNode, routerPanesStream, structureContext])\n\n  return data\n}\n","import {uuid} from '@sanity/uuid'\nimport {firstValueFrom, type Observable} from 'rxjs'\nimport {type DocumentStore, getPublishedId} from 'sanity'\n\nimport {PaneResolutionError} from '../../../structureResolvers'\n\nexport function removeDraftPrefix(documentId: string): string {\n  const publishedId = getPublishedId(documentId)\n\n  if (publishedId !== documentId) {\n    console.warn(\n      'Removed unexpected draft id in document link: All links to documents should have the ' +\n        '`drafts.`-prefix removed and something appears to have made an intent link to `%s`',\n      documentId,\n    )\n  }\n\n  return publishedId\n}\n\nexport async function ensureDocumentIdAndType(\n  documentStore: DocumentStore,\n  id: string | undefined,\n  type: string | undefined,\n): Promise<{id: string; type: string}> {\n  if (id && type) return {id, type}\n  if (!id && type) return {id: uuid(), type}\n  if (id && !type) {\n    const resolvedType = await firstValueFrom(\n      documentStore.resolveTypeForDocument(id) as Observable<string>,\n    )\n\n    return {id, type: resolvedType}\n  }\n\n  throw new PaneResolutionError({\n    message: 'Neither document `id` or `type` was provided when trying to resolve intent.',\n  })\n}\n","import {memo, useCallback, useEffect, useState} from 'react'\nimport {isRecord, useDocumentStore} from 'sanity'\nimport {useRouter, useRouterState} from 'sanity/router'\n\nimport {resolveIntent} from '../../../structureResolvers'\nimport {useStructureTool} from '../../../useStructureTool'\nimport {ensureDocumentIdAndType} from './utils'\n\nconst EMPTY_RECORD: Record<string, unknown> = {}\n\n/**\n * A component that receives an intent from props and redirects to the resolved\n * intent location (while showing a loading spinner during the process)\n */\nexport const IntentResolver = memo(function IntentResolver() {\n  const {navigate} = useRouter()\n  const maybeIntent = useRouterState(\n    useCallback((routerState) => {\n      const intentName = typeof routerState.intent === 'string' ? routerState.intent : undefined\n      return intentName\n        ? {\n            intent: intentName,\n            params: isRecord(routerState.params) ? routerState.params : EMPTY_RECORD,\n            payload: routerState.payload,\n          }\n        : undefined\n    }, []),\n  )\n  const {rootPaneNode, structureContext} = useStructureTool()\n  const documentStore = useDocumentStore()\n  const [error, setError] = useState<unknown>(null)\n\n  // this re-throws errors so that parent ErrorBoundary's can handle them properly\n  if (error) throw error\n\n  // eslint-disable-next-line consistent-return\n  useEffect(() => {\n    if (maybeIntent) {\n      const {intent, params, payload} = maybeIntent\n\n      let cancelled = false\n      async function effect() {\n        const {id, type} = await ensureDocumentIdAndType(\n          documentStore,\n          typeof params.id === 'string' ? params.id : undefined,\n          typeof params.type === 'string' ? params.type : undefined,\n        )\n\n        if (cancelled) return\n\n        const panes = await resolveIntent({\n          intent,\n          params: {...params, id, type},\n          payload,\n          rootPaneNode,\n          structureContext,\n        })\n\n        if (cancelled) return\n\n        navigate({panes}, {replace: true})\n      }\n\n      effect().catch(setError)\n\n      return () => {\n        cancelled = true\n      }\n    }\n  }, [documentStore, maybeIntent, navigate, rootPaneNode, structureContext])\n\n  return null\n})\n","import {generateHelpUrl} from '@sanity/generate-help-url'\nimport {SyncIcon} from '@sanity/icons'\nimport {Box, Card, Code, Container, Heading, Stack, Text} from '@sanity/ui'\nimport {useCallback} from 'react'\nimport {useTranslation} from 'sanity'\nimport {styled} from 'styled-components'\n\nimport {Button} from '../../../ui-components'\nimport {structureLocaleNamespace} from '../../i18n'\nimport {SerializeError} from '../../structureBuilder'\nimport {PaneResolutionError} from '../../structureResolvers'\n\nconst PathSegment = styled.span`\n  &:not(:last-child)::after {\n    content: ' âž ';\n    opacity: 0.5;\n  }\n`\n\nfunction formatStack(stack: string) {\n  return (\n    stack\n      // Prettify builder functions\n      .replace(/\\(\\.\\.\\.\\)\\./g, '(...)\\n  .')\n      // Remove webpack cruft from function names\n      .replace(/__WEBPACK_IMPORTED_MODULE_\\d+_+/g, '')\n      // Remove default export postfix from function names\n      .replace(/___default\\./g, '.')\n      // Replace full host path, leave only path to JS-file\n      .replace(new RegExp(` \\\\(https?:\\\\/\\\\/${window.location.host}`, 'g'), ' (')\n  )\n}\n\ninterface StructureErrorProps {\n  error: unknown\n}\n\nexport function StructureError({error}: StructureErrorProps) {\n  if (!(error instanceof PaneResolutionError)) {\n    throw error\n  }\n  const {cause} = error\n  const {t} = useTranslation(structureLocaleNamespace)\n\n  // Serialize errors are well-formatted and should be readable, in these cases a stack trace is\n  // usually not helpful. Build errors in dev (with HMR) usually also contains a bunch of garbage\n  // instead of an actual error message, so make sure we show the message in these cases as well\n  const stack = cause?.stack || error.stack\n  const showStack =\n    stack && !(cause instanceof SerializeError) && !error.message.includes('Module build failed:')\n\n  const path = cause instanceof SerializeError ? cause.path : []\n  const helpId = (cause instanceof SerializeError && cause.helpId) || error.helpId\n\n  const handleReload = useCallback(() => {\n    window.location.reload()\n  }, [])\n\n  return (\n    <Card height=\"fill\" overflow=\"auto\" padding={4} sizing=\"border\" tone=\"critical\">\n      <Container>\n        <Heading as=\"h2\">{t('structure-error.header.text')}</Heading>\n\n        <Card marginTop={4} padding={4} radius={2} overflow=\"auto\" shadow={1} tone=\"inherit\">\n          {path.length > 0 && (\n            <Stack space={2}>\n              <Text size={1} weight=\"medium\">\n                {t('structure-error.structure-path.label')}\n              </Text>\n              <Code>\n                {/* TODO: it seems like the path is off by one and includes */}\n                {/* `root` twice  */}\n                {path.slice(1).map((segment, i) => (\n                  <PathSegment key={`${segment}-${i}`}>{segment}</PathSegment>\n                ))}\n              </Code>\n            </Stack>\n          )}\n\n          <Stack marginTop={4} space={2}>\n            <Text size={1} weight=\"medium\">\n              {t('structure-error.error.label')}\n            </Text>\n            <Code>{showStack ? formatStack(stack) : error.message}</Code>\n          </Stack>\n\n          {helpId && (\n            <Box marginTop={4}>\n              <Text>\n                <a href={generateHelpUrl(helpId)} rel=\"noopener noreferrer\" target=\"_blank\">\n                  {t('structure-error.docs-link.text')}\n                </a>\n              </Text>\n            </Box>\n          )}\n\n          <Box marginTop={4}>\n            <Button\n              text={t('structure-error.reload-button.text')}\n              icon={SyncIcon}\n              tone=\"primary\"\n              onClick={handleReload}\n            />\n          </Box>\n        </Card>\n      </Container>\n    </Card>\n  )\n}\n","import {WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Card, Container, Flex, Stack, Text} from '@sanity/ui'\nimport {useTranslation} from 'sanity'\n\nimport {structureLocaleNamespace} from '../../i18n'\n\nexport function NoDocumentTypesScreen() {\n  const {t} = useTranslation(structureLocaleNamespace)\n\n  return (\n    <Card height=\"fill\">\n      <Flex align=\"center\" height=\"fill\" justify=\"center\" padding={4} sizing=\"border\">\n        <Container width={0}>\n          <Card padding={4} radius={2} shadow={1} tone=\"caution\">\n            <Flex>\n              <Box>\n                <Text size={1}>\n                  <WarningOutlineIcon />\n                </Text>\n              </Box>\n              <Stack flex={1} marginLeft={3} space={3}>\n                <Text as=\"h1\" size={1} weight=\"medium\">\n                  {t('no-document-types-screen.title')}\n                </Text>\n                <Text as=\"p\" muted size={1}>\n                  {t('no-document-types-screen.subtitle')}\n                </Text>\n                <Text as=\"p\" muted size={1}>\n                  <a\n                    href=\"https://www.sanity.io/docs/create-a-schema-and-configure-sanity-studio\"\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                  >\n                    {t('no-document-types-screen.link-text')}\n                  </a>\n                </Text>\n              </Stack>\n            </Flex>\n          </Card>\n        </Container>\n      </Flex>\n    </Card>\n  )\n}\n","import {type ObjectSchemaType} from '@sanity/types'\nimport {useEffect} from 'react'\nimport {\n  unstable_useValuePreview as useValuePreview,\n  useEditState,\n  usePerspective,\n  useSchema,\n  useTranslation,\n} from 'sanity'\n\nimport {LOADING_PANE} from '../../constants'\nimport {useDocumentLastRev} from '../../hooks/useDocumentLastRev'\nimport {structureLocaleNamespace} from '../../i18n'\nimport {type Panes} from '../../structureResolvers'\nimport {type DocumentPaneNode} from '../../types'\nimport {useStructureTool} from '../../useStructureTool'\n\ninterface StructureTitleProps {\n  resolvedPanes: Panes['resolvedPanes']\n}\n\n// TODO: Fix state jank when editing different versions inside panes.\nconst DocumentTitle = (props: {documentId: string; documentType: string}) => {\n  const {documentId, documentType} = props\n  const {selectedReleaseId} = usePerspective()\n\n  const editState = useEditState(documentId, documentType, 'default', selectedReleaseId)\n  const schema = useSchema()\n  const {t} = useTranslation(structureLocaleNamespace)\n  const isNewDocument = !editState?.published && !editState?.draft\n  const documentValue = editState?.version || editState?.draft || editState?.published\n  const schemaType = schema.get(documentType) as ObjectSchemaType | undefined\n\n  const {value, isLoading: previewValueIsLoading} = useValuePreview({\n    enabled: !!documentValue,\n    schemaType,\n    value: documentValue,\n  })\n\n  const {lastRevisionDocument} = useDocumentLastRev(documentId, documentType)\n  const isDeleted = lastRevisionDocument && !documentValue\n\n  // if the document is deleted, we don't want to show the title\n  const documentTitle = isDeleted\n    ? ''\n    : isNewDocument\n      ? t('browser-document-title.new-document', {\n          schemaType: schemaType?.title || schemaType?.name,\n        })\n      : value?.title || t('browser-document-title.untitled-document')\n\n  const settled = editState.ready && !previewValueIsLoading\n  const newTitle = useConstructDocumentTitle(documentTitle)\n  useEffect(() => {\n    if (!settled) return\n    // Set the title as the document title\n    document.title = newTitle\n  }, [documentTitle, settled, newTitle])\n\n  return null\n}\n\nconst PassthroughTitle = (props: {title?: string}) => {\n  const {title} = props\n  const newTitle = useConstructDocumentTitle(title)\n  useEffect(() => {\n    // Set the title as the document title\n    document.title = newTitle\n  }, [newTitle, title])\n  return null\n}\n\nexport const StructureTitle = (props: StructureTitleProps) => {\n  const {resolvedPanes} = props\n\n  if (!resolvedPanes?.length) return null\n\n  const lastPane = resolvedPanes[resolvedPanes.length - 1]\n\n  // If the last pane is loading, display the structure tool title only\n  if (isLoadingPane(lastPane)) {\n    return <PassthroughTitle />\n  }\n\n  // If the last pane is a document\n  if (isDocumentPane(lastPane)) {\n    // Passthrough the document pane's title, which may be defined in structure builder\n    if (lastPane?.title) {\n      return <PassthroughTitle title={lastPane.title} />\n    }\n\n    // Otherwise, display a `document.title` containing the resolved Sanity document title\n    return <DocumentTitle documentId={lastPane.options.id} documentType={lastPane.options.type} />\n  }\n\n  // Otherwise, display the last pane's title (if present)\n  return <PassthroughTitle title={lastPane?.title} />\n}\n\n/**\n * Construct a pipe delimited title containing `activeTitle` (if applicable) and the base structure title.\n *\n * @param activeTitle - Title of the first segment\n *\n * @returns A pipe delimited title in the format `${activeTitle} | %BASE_STRUCTURE_TITLE%`\n * or simply `%BASE_STRUCTURE_TITLE` if `activeTitle` is undefined.\n */\nfunction useConstructDocumentTitle(activeTitle?: string) {\n  const structureToolBaseTitle = useStructureTool().structureContext.title\n  return [activeTitle, structureToolBaseTitle].filter((title) => title).join(' | ')\n}\n\n// Type guards\nfunction isDocumentPane(pane: Panes['resolvedPanes'][number]): pane is DocumentPaneNode {\n  return pane !== LOADING_PANE && pane.type === 'document'\n}\n\nfunction isLoadingPane(pane: Panes['resolvedPanes'][number]): pane is typeof LOADING_PANE {\n  return pane === LOADING_PANE\n}\n","import {PortalProvider, useTheme, useToast} from '@sanity/ui'\nimport {isHotkey} from 'is-hotkey-esm'\nimport {Fragment, memo, useCallback, useEffect, useState} from 'react'\nimport {_isCustomDocumentTypeDefinition, useSchema} from 'sanity'\nimport {useRouterState} from 'sanity/router'\nimport {styled} from 'styled-components'\n\nimport {LOADING_PANE} from '../../constants'\nimport {LoadingPane, StructureToolPane} from '../../panes'\nimport {useResolvedPanes} from '../../structureResolvers'\nimport {type PaneNode} from '../../types'\nimport {useStructureTool} from '../../useStructureTool'\nimport {PaneLayout} from '../pane'\nimport {NoDocumentTypesScreen} from './NoDocumentTypesScreen'\nimport {StructureTitle} from './StructureTitle'\n\ninterface StructureToolProps {\n  onPaneChange: (panes: Array<PaneNode | typeof LOADING_PANE>) => void\n}\n\nconst StyledPaneLayout = styled(PaneLayout)`\n  min-height: 100%;\n  min-width: 320px;\n`\n\nconst isSaveHotkey = isHotkey('mod+s')\n\n/**\n * @internal\n */\nexport const StructureTool = memo(function StructureTool({onPaneChange}: StructureToolProps) {\n  const {push: pushToast} = useToast()\n  const schema = useSchema()\n  const {layoutCollapsed, setLayoutCollapsed} = useStructureTool()\n  const {paneDataItems, resolvedPanes} = useResolvedPanes()\n  // Intent resolving is processed by the sibling `<IntentResolver />` but it doesn't have a UI for indicating progress.\n  // We handle that here, so if there are only 1 pane (the root structure), and there's an intent state in the router, we need to show a placeholder LoadingPane until\n  // the structure is resolved and we know what panes to load/display\n  const isResolvingIntent = useRouterState(\n    useCallback((routerState) => typeof routerState.intent === 'string', []),\n  )\n  const {\n    sanity: {media},\n  } = useTheme()\n\n  const [portalElement, setPortalElement] = useState<HTMLDivElement | null>(null)\n\n  const handleRootCollapse = useCallback(() => setLayoutCollapsed(true), [setLayoutCollapsed])\n  const handleRootExpand = useCallback(() => setLayoutCollapsed(false), [setLayoutCollapsed])\n\n  useEffect(() => {\n    // we check for length before emitting here to skip the initial empty array\n    // state from the `useResolvedPanes` hook. there should always be a root\n    // pane emitted on subsequent emissions\n    if (resolvedPanes.length) {\n      onPaneChange(resolvedPanes)\n    }\n  }, [onPaneChange, resolvedPanes])\n\n  useEffect(() => {\n    const handleGlobalKeyDown = (event: KeyboardEvent) => {\n      // Prevent `Cmd+S`\n      if (isSaveHotkey(event)) {\n        event.preventDefault()\n\n        pushToast({\n          closable: true,\n          id: 'auto-save-message',\n          status: 'info',\n          title: 'Your work is automatically saved!',\n          duration: 4000,\n        })\n      }\n    }\n\n    window.addEventListener('keydown', handleGlobalKeyDown)\n    return () => window.removeEventListener('keydown', handleGlobalKeyDown)\n  }, [pushToast])\n\n  const hasDefinedDocumentTypes = schema._original?.types.some(_isCustomDocumentTypeDefinition)\n\n  if (!hasDefinedDocumentTypes) {\n    return <NoDocumentTypesScreen />\n  }\n\n  return (\n    <PortalProvider element={portalElement || null}>\n      <StyledPaneLayout\n        flex={1}\n        height={layoutCollapsed ? undefined : 'fill'}\n        minWidth={media[1]}\n        onCollapse={handleRootCollapse}\n        onExpand={handleRootExpand}\n      >\n        {paneDataItems.map(\n          ({\n            active,\n            childItemId,\n            groupIndex,\n            itemId,\n            key: paneKey,\n            pane,\n            index: paneIndex,\n            params: paneParams,\n            path,\n            payload,\n            siblingIndex,\n            selected,\n          }) => (\n            <Fragment key={`${pane === LOADING_PANE ? 'loading' : pane.type}-${paneIndex}`}>\n              {pane === LOADING_PANE ? (\n                <LoadingPane paneKey={paneKey} path={path} selected={selected} />\n              ) : (\n                <StructureToolPane\n                  active={active}\n                  groupIndex={groupIndex}\n                  index={paneIndex}\n                  pane={pane}\n                  childItemId={childItemId}\n                  itemId={itemId}\n                  paneKey={paneKey}\n                  params={paneParams}\n                  payload={payload}\n                  path={path}\n                  selected={selected}\n                  siblingIndex={siblingIndex}\n                />\n              )}\n            </Fragment>\n          ),\n        )}\n        {/* If there's just 1 pane (the root), or less, and we're resolving an intent then it's necessary to show */}\n        {/* a loading indicator as the intent resolving is async, could take a while and can also be interrupted/redirected */}\n        {paneDataItems.length <= 1 && isResolvingIntent && (\n          <LoadingPane paneKey=\"intent-resolver\" />\n        )}\n      </StyledPaneLayout>\n      <StructureTitle resolvedPanes={resolvedPanes} />\n      <div data-portal=\"\" ref={setPortalElement} />\n    </PortalProvider>\n  )\n})\n","import {useEffect, useState} from 'react'\nimport {SourceProvider, type Tool, useWorkspace} from 'sanity'\n\nimport {ErrorBoundary} from '../../../ui-components/errorBoundary'\nimport {setActivePanes} from '../../getIntentState'\nimport {StructureToolProvider} from '../../StructureToolProvider'\nimport {type StructureToolOptions} from '../../types'\nimport {IntentResolver} from './intentResolver'\nimport {StructureError} from './StructureError'\nimport {StructureTool} from './StructureTool'\n\ninterface StructureToolBoundaryProps {\n  tool: Tool<StructureToolOptions>\n}\n\nexport function StructureToolBoundary({tool: {options}}: StructureToolBoundaryProps) {\n  const {unstable_sources: sources} = useWorkspace()\n  const [firstSource] = sources\n  const {source, defaultDocumentNode, structure} = options || {}\n\n  // Set active panes to blank on mount and unmount\n  useEffect(() => {\n    setActivePanes([])\n    return () => setActivePanes([])\n  }, [])\n\n  const [{error}, setError] = useState<{error: unknown}>({error: null})\n\n  // this re-throws if the error it catches is not a PaneResolutionError\n  if (error) return <StructureError error={error} />\n\n  return (\n    <ErrorBoundary onCatch={setError}>\n      <SourceProvider name={source || firstSource.name}>\n        <StructureToolProvider defaultDocumentNode={defaultDocumentNode} structure={structure}>\n          <StructureTool onPaneChange={setActivePanes} />\n          <IntentResolver />\n        </StructureToolProvider>\n      </SourceProvider>\n    </ErrorBoundary>\n  )\n}\n"],"names":["PaneResolutionError","Error","constructor","message","context","helpId","cause","name","randomIdCache","WeakMap","assignId","obj","cachedValue","get","id","nanoid","set","isPromise","thing","then","isSerializable","isRecord","serialize","rethrowWithPaneResolutionErrors","next","unresolvedPane","flatIndex","e","wrapWithPublishReplay","args","pipe","publishReplay","refCount","createPaneResolver","middleware","resolvePane","isObservable","from","switchMap","result","observableOf","bindCache","memoBind","methodKey","boundMethods","Map","bound","method","bind","resolveIntent","options","resolvedPaneCache","nextFn","key","path","join","cachedResolvedPane","fallbackEditorPanes","params","omit","type","payload","traverse","currentId","intent","parent","levelIndex","structureContext","targetId","schemaTypeName","otherParams","resolvedPane","firstValueFrom","splitIndex","index","undefined","panes","slice","length","map","i","depthIndex","canHandleIntent","pane","filter","child","items","Promise","all","item","nextLevelIndex","resolve","_id","flat","closestPaneToRoot","rootPaneNode","sort","a","b","fallbackEditorChild","nodeId","replace","resolveDocumentNode","template","defaultDocumentBuilder","schemaType","documentId","initialValueTemplate","hashContext","JSON","stringify","parentId","serializeOptionsIndex","serializeOptions","serializeOptionsPath","hashResolvedPaneMeta","meta","normalized","routerPaneSibling","groupIndex","siblingIndex","paneNode","resolvePaneTree","flattenedRouterPanes","current","rest","resolvedPaneMeta","loadingPanes","restIndex","_","currentIndex","nextStream","startsWith","concat","nextResolvedPanes","console","warn","generateHelpUrl","createResolvedPaneNodeStream","routerPanesStream","initialCacheState","cacheKeysByFlatIndex","NEVER","rawRouterPanes","routerPanes","flatMap","routerPaneGroup","startWith","pairwise","prev","curr","prevValue","currValue","isEqual","diffIndex","scan","acc","beforeDiffIndex","afterDiffIndex","keysToKeep","Set","keySet","Array","keysToDelete","has","delete","cacheKeySet","add","nextPane","prevPane","distinctUntilChanged","nextValue","useRouterPanesStream","$","_c","routerStateSubject","useState","_temp","t0","t1","asObservable","_temp2","routerPanes$","state","routerState","useRouter","t2","t3","useEffect","_routerState","ReplaySubject","useResolvedPanes","error","setError","useStructureTool","Symbol","for","paneDataItems","resolvedPanes","data","setData","subscription","_temp5","subscribe","unsubscribe","reduce","_temp3","groupsLen","itemId","nextGroup","active","childItemId","LOADING_PANE","selected","_temp4","pane_0","currentGroup","ensureDocumentIdAndType","documentStore","uuid","resolvedType","resolveTypeForDocument","EMPTY_RECORD","IntentResolver","memo","navigate","maybeIntent","useRouterState","useDocumentStore","cancelled","effect","catch","intentName","PathSegment","styled","span","formatStack","stack","RegExp","window","location","host","StructureError","t","useTranslation","structureLocaleNamespace","showStack","SerializeError","includes","handleReload","t4","t5","t6","t7","t8","t9","t10","t11","t12","SyncIcon","t13","t14","segment","reload","NoDocumentTypesScreen","DocumentTitle","props","documentType","selectedReleaseId","usePerspective","editState","useEditState","schema","useSchema","isNewDocument","published","draft","documentValue","version","value","isLoading","previewValueIsLoading","useValuePreview","enabled","lastRevisionDocument","useDocumentLastRev","documentTitle","title","settled","ready","newTitle","useConstructDocumentTitle","document","PassthroughTitle","StructureTitle","lastPane","isLoadingPane","isDocumentPane","activeTitle","structureToolBaseTitle","StyledPaneLayout","PaneLayout","isSaveHotkey","isHotkey","StructureTool","onPaneChange","push","pushToast","useToast","layoutCollapsed","setLayoutCollapsed","isResolvingIntent","sanity","useTheme","media","portalElement","setPortalElement","handleRootCollapse","handleRootExpand","handleGlobalKeyDown","event","preventDefault","closable","status","duration","addEventListener","removeEventListener","_original","types","some","_isCustomDocumentTypeDefinition","t15","t16","paneKey","paneIndex","paneParams","StructureToolBoundary","tool","unstable_sources","sources","useWorkspace","firstSource","source","defaultDocumentNode","structure","setActivePanes"],"mappings":"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"}